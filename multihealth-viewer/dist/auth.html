<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Microsoft Auth</title>
  <script src="https://res.cdn.office.net/teams-js/2.12.0/js/MicrosoftTeams.min.js"></script>
  <script src="https://alcdn.msauth.net/browser/2.25.0/js/msal-browser.min.js"></script>
</head>
<body>

<script>
microsoftTeams.app.initialize();

const msalConfig = {
  auth: {
    clientId: "1135fab5-62e8-4cb1-b472-880c477a8812",   // âœ… Ton App ID Azure
    authority: "https://login.microsoftonline.com/03d0481a-a8ca-44b5-aeec-9bb332d93868",
    redirectUri: window.location.origin + "/auth.html"  // âœ… IMPORTANT
  }
};

const loginRequest = {
  scopes: ["User.Read", "Files.Read.All", "Sites.Read.All", "offline_access"]
};

const msalInstance = new msal.PublicClientApplication(msalConfig);

// âœ… Quand MSAL revient aprÃ¨s redirection, notifier Teams
msalInstance.handleRedirectPromise().then((response) => {
  if (response) {
    console.log("âœ… Auth MSAL OK");
    microsoftTeams.authentication.notifySuccess(response.accessToken);
  }
}).catch(err => {
  microsoftTeams.authentication.notifyFailure(err.toString());
});

// âœ… ðŸ‘‡ PLUS DE loginPopup : Teams le bloque
msalInstance.loginRedirect(loginRequest);
</script>

</body>
</html>
